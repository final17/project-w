input {
  tcp {
    port => 5000
    codec => json
  }
}

filter {
  if "Error" in [type] {
    mutate {
      add_field => { "alert" => "Error Detected" }
    }
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    user => "elastic"
    password => "changeme"
    index => "logstash-%{+YYYY.MM.dd}"
  }

  if [alert] == "Error Detected" {
    slack {
      url => "https://hooks.slack.com/services/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"
      channel => "#ìŠ¤í”„ë§ ì•±"
      username => "Logstash"
      icon_emoji => ":warning:"
      attachments => [
        {
          "pretext" => "âš ï¸ ì—ëŸ¬ ë°œìƒ ì•Œë¦¼"
          "author_name" => "final17"
          "author_link" => "https://github.com/final17/project-w"
          "color" => "#ff0000"
          "title" => "ì—ëŸ¬ ìƒì„¸ ì •ë³´"
          "title_link" => "https://api.slack.com/"
          "text" => "ðŸ”´ [ALERT] ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: `%{message}`"
          "image_url" => "http://my-website.com/path/to/image.jpg"
          "thumb_url" => "http://example.com/path/to/thumb.png"
          "footer" => "Slack API"
          "footer_icon" => "https://platform.slack-edge.com/img/default_application_icon.png"
          "ts" => "%{[@timestamp]}"
        }
      ]
    }
  }
}
